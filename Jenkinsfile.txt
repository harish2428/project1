pipeline {
    agent any
	tools{
	  maven 'MAVEN'
	}   
    environment {
	APP_NAME = "deploy"
        TOMCAT_HOME = "C:/Program Files/Apache Software Foundation/Tomcat 9.0"
        WAR_FILE = "devOpsWeb.war"
        TOMCAT_MANAGER_USERNAME = "harish"
        TOMCAT_MANAGER_PASSWORD = "bvbschool@24"
        TOMCAT_MANAGER_URL = "http://harish:bvbschool@24@localhost:8080/"
    }
    
    stages {
        stage('Checkout') {
            steps {
                git 'https://github.com/harish2428/project1.git'
            }
        }
        
        stage('Build') {
            steps {
                sh 'mvn clean package'
            }
        }
        
        stage('Deploy to Tomcat') {
            steps {
                script {
                    def deployCommand = "curl --upload-file target/$WAR_FILE $TOMCAT_MANAGER_URL/undeploy?path=/$APP_NAME"
                    sh deployCommand
                    deployCommand = "curl --upload-file target/$WAR_FILE $TOMCAT_MANAGER_URL/deploy?path=/$APP_NAME&update=true"
                    sh deployCommand
                }
            }
        }
    }
}
